var t = require('tap')
var PSLayerToHTML = require('../lib/PSLayerToHTML_throughStream')

t.test('PSLayerToHTML', function(t){
  
  var throughStream = PSLayerToHTML()
  
  throughStream.pipe(process.stdout)
  
  mockLayers.forEach(function(layer){
    throughStream.write(layer)
  })
  
  t.end()
})

var mockLayers = [
  {"layerID":-1,"_childLayerIDs":[8,10,1],"_childCount":3,"_namePath":["some stuff.psd"]},
  {"smartObject":{"fileReference":"http%3A%2F%2Fgraph.facebook.com%2Fsubtlegradient%2Fpicture.jpeg","placed":"rasterizeContent"},"bounds":{"height":50,"width":50,"right":78,"bottom":76,"left":28,"top":26},"hasFilterMask":false,"hasVectorMask":false,"hasUserMask":false,"layerSection":"layerSectionContent","layerFXVisible":false,"itemIndex":6,"layerID":8,"opacity":255,"visible":true,"name":"SubtleGradient","metadata":{"layerTime":1367085872.89045,"layerXMP":"<?xpacket begin=\"\ufeff\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>\n<x:xmpmeta xmlns:x=\"adobe:ns:meta/\" x:xmptk=\"Adobe XMP Core 5.3-c011 66.145661, 2012/02/06-14:56:27        \">\n   <rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n      <rdf:Description rdf:about=\"\"\n            xmlns:json=\"https://github.com/subtleGradient/node-photoshop-inspector-server\">\n         <json:source>\"http://graph.facebook.com/subtlegradient/picture\"</json:source>\n      </rdf:Description>\n   </rdf:RDF>\n</x:xmpmeta>\n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                                                                                                    \n                           \n<?xpacket end=\"w\"?>"},"parsedMetadata":{"source":"http://graph.facebook.com/subtlegradient/picture"},"_parentId":-1,"_childIndex":0,"_namePath":["some stuff.psd","SubtleGradient"]},
  {"bounds":{"height":256,"width":256,"right":256,"bottom":256,"left":0,"top":0},"hasFilterMask":false,"hasVectorMask":false,"hasUserMask":false,"layerSection":"layerSectionStart","layerFXVisible":false,"itemIndex":5,"layerID":10,"opacity":255,"visible":true,"name":"Group 1","metadata":{"layerTime":1367085872.89043},"parsedMetadata":{},"_parentId":-1,"_childIndex":1,"_namePath":["some stuff.psd","Group 1"],"_childCount":2,"_childLayerIDs":[5,6]},
  {"bounds":{"height":39,"width":86,"right":177,"bottom":146,"left":91,"top":107},"hasFilterMask":false,"hasVectorMask":false,"hasUserMask":false,"layerSection":"layerSectionContent","textKey":{"kerningRange":[],"paragraphStyleRange":[{"paragraphStyle":{"defaultStyle":{"strokeColor":{"blue":0,"grain":0,"red":0},"color":{"blue":0,"grain":0,"red":0},"textLanguage":"englishLanguage","baselineDirection":"withStream","figureStyle":"normal","ornaments":false,"stylisticAlternates":false,"connectionForms":false,"titling":false,"swash":false,"ordinals":false,"fractions":false,"oldStyle":false,"alternateLigatures":false,"contextualLigatures":true,"altligature":false,"ligature":true,"underline":"underlineOff","strikethrough":"strikethroughOff","baseline":"normal","markYDistFromBaseline":0,"diacYOffset":0,"diacXOffset":0,"diacVPos":"diacVPosOpenType","kashidas":"kashidaDefault","digitSet":"arabicDigits","fontCaps":"normal","autoKern":"metricsKern","characterRotation":0,"baselineShift":0,"tracking":0,"autoLeading":true,"syntheticItalic":false,"syntheticBold":false,"verticalScale":100,"horizontalScale":100,"size":12,"fontTechnology":0,"fontScript":0,"fontStyleName":"Regular","fontName":"Myriad Pro","fontPostScriptName":"MyriadPro-Regular"},"defaultTabWidth":36,"textComposerEngine":"textLatinCJKComposer","textEveryLineComposer":false,"kurikaeshiMojiShori":false,"preferredKinsokuOrder":"pushIn","burasagari":"burasagariNone","keepTogether":true,"autoTCY":0,"hangingRoman":false,"singleWordJustification":"justifyAll","justificationGlyphMaximum":1,"justificationGlyphDesired":1,"justificationGlyphMinimum":1,"justificationLetterMaximum":0,"justificationLetterDesired":0,"justificationLetterMinimum":0,"justificationWordMaximum":1.33000004291534,"justificationWordDesired":1,"justificationWordMinimum":0.80000001192093,"hyphenationPreference":0.5,"hyphenateCapitalized":true,"hyphenationZone":36,"hyphenateLimit":0,"hyphenatePostLength":2,"hyphenatePreLength":2,"hyphenateWordSize":6,"hyphenate":true,"justificationMethodType":"justifMethodAutomatic","kashidaWidthType":"kashidaWidthMedium","directionType":"dirLeftToRight","leadingType":"leadingBelow","autoLeadingPercentage":1.20000004768372,"dropCapMultiplier":1,"spaceAfter":0,"spaceBefore":0,"endIndent":0,"startIndent":0,"firstLineIndent":0,"align":"left","styleSheetHasParent":true},"to":5,"from":0}],"textStyleRange":[{"textStyle":{"strokeColor":{"blue":255,"grain":255,"red":255},"color":{"blue":255,"grain":255,"red":255},"markYDistFromBaseline":100,"digitSet":"defaultDigits","tracking":-5,"leading":18,"autoLeading":false,"size":48,"fontTechnology":1,"fontScript":0,"fontStyleName":"Regular","fontName":"Helvetica Neue","fontPostScriptName":"HelveticaNeue","styleSheetHasParent":true},"to":5,"from":0}],"textShape":[{"base":{"vertical":0,"horizontal":0},"firstBaselineMinimum":0,"frameBaselineAlignment":"alignByAscent","spacing":0,"columnGutter":0,"rowGutter":0,"rowMajorOrder":true,"columnCount":1,"rowCount":1,"transform":{"ty":0,"tx":0,"yy":1,"yx":0,"xy":0,"xx":1},"orientation":"horizontal","char":"paint"}],"boundingBox":{"bottom":1,"right":85.2956237792969,"top":-34,"left":4},"bounds":{"bottom":23.088134765625,"right":86.1110458374023,"top":-41.1357421875,"left":0},"antiAlias":"antiAliasCrisp","orientation":"horizontal","textGridding":"none","textClickPoint":{"vertical":55.4595947265625,"horizontal":34.9395751953125},"warp":{"warpRotate":"horizontal","warpPerspectiveOther":0,"warpPerspective":0,"warpValue":0,"warpStyle":"warpNone"},"textKey":"Lulz"},"layerEffects":{"solidFill":{"color":{"blue":127.996101379395,"grain":113.003891855478,"red":106.0000012815},"opacity":100,"mode":"normal","enabled":true},"innerShadow":{"transferSpec":{"name":"Linear"},"antiAlias":false,"noise":0,"blur":1,"chokeMatte":0,"distance":1,"localLightingAngle":90,"useGlobalAngle":false,"opacity":10,"color":{"blue":0.24953082902357,"grain":0.24517359095626,"red":0.02726314742176},"mode":"linearLight","enabled":true},"scale":100},"layerFXVisible":true,"itemIndex":4,"layerID":5,"opacity":255,"visible":true,"name":"Lulz","metadata":{"layerTime":1367085872.89042},"parsedMetadata":{},"_parentId":10,"_childIndex":0,"_namePath":["some stuff.psd","Group 1","Lulz"]},
  {"bounds":{"height":88,"width":193,"right":227,"bottom":172,"left":34,"top":84},"adjustment":[{"color":{"blue":0,"grain":0,"red":0}}],"hasFilterMask":false,"hasVectorMask":true,"hasUserMask":false,"layerSection":"layerSectionContent","layerEffects":{"solidFill":{"color":{"blue":255,"grain":255,"red":255},"opacity":100,"mode":"normal","enabled":true},"dropShadow":{"layerConceals":true,"transferSpec":{"name":"Linear"},"antiAlias":false,"noise":0,"blur":4,"chokeMatte":0,"distance":1,"localLightingAngle":90,"useGlobalAngle":false,"opacity":80,"color":{"blue":0,"grain":0,"red":0},"mode":"normal","enabled":true},"scale":100},"layerFXVisible":true,"itemIndex":3,"layerID":6,"opacity":255,"visible":true,"name":"Rounded Rectangle 1","metadata":{"layerTime":1367085872.88712},"parsedMetadata":{},"_parentId":10,"_childIndex":1,"_namePath":["some stuff.psd","Group 1","Rounded Rectangle 1"]},
  {"bounds":{"height":256,"width":256,"right":256,"bottom":256,"left":0,"top":0},"hasFilterMask":false,"hasVectorMask":false,"hasUserMask":false,"layerSection":"layerSectionContent","layerFXVisible":false,"itemIndex":1,"layerID":1,"opacity":255,"visible":true,"name":"Background","metadata":{"layerTime":1367085872.8871},"parsedMetadata":{},"_parentId":-1,"_childIndex":2,"_namePath":["some stuff.psd","Background"]},
]
